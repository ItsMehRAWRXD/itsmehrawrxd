<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Encryption & Stub Generator - RawrZ Security Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .tabs {
            display: flex;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 5px;
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            background: transparent;
            border: none;
            color: white;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1.1em;
            font-weight: 500;
        }

        .tab.active {
            background: rgba(255,255,255,0.2);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .tab:hover {
            background: rgba(255,255,255,0.15);
        }

        .tab-content {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }

        .tab-content.active {
            display: block;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .file-upload {
            border: 2px dashed #667eea;
            border-radius: 8px;
            padding: 30px;
            text-align: center;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            background: #f0f2ff;
            border-color: #5a6fd8;
        }

        .file-upload.dragover {
            background: #e8ecff;
            border-color: #4c63d2;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }
        
        .algorithm-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 8px;
            margin-top: 8px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #6c757d 0%, #495057 100%);
            box-shadow: 0 4px 15px rgba(108, 117, 125, 0.3);
        }

        .btn-secondary:hover {
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .result-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .result-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .result-content {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e1e5e9;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-success {
            background: #28a745;
        }

        .status-error {
            background: #dc3545;
        }

        .status-warning {
            background: #ffc107;
        }

        .status-info {
            background: #17a2b8;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e1e5e9;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
        }

        .algorithm-info {
            background: #e8f4fd;
            border: 1px solid #bee5eb;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .algorithm-info h4 {
            color: #0c5460;
            margin-bottom: 10px;
        }

        .algorithm-info p {
            color: #0c5460;
            margin: 5px 0;
        }

        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .feature-card {
            background: #f8f9fa;
            border: 1px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .feature-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.1);
        }

        .feature-card h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .feature-card p {
            color: #666;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .tab {
                margin-bottom: 5px;
            }
        }

        /* Achievement Badge System */
        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.75em;
            font-weight: bold;
            margin: 2px;
            box-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
            animation: badgeGlow 2s ease-in-out infinite alternate;
        }

        .achievement-badge.platinum {
            background: linear-gradient(135deg, #e5e4e2, #f7f7f7);
            color: #333;
            box-shadow: 0 2px 4px rgba(229, 228, 226, 0.3);
        }

        .achievement-badge.gold {
            background: linear-gradient(135deg, #ffd700, #ffed4e);
            color: #333;
            box-shadow: 0 2px 4px rgba(255, 215, 0, 0.3);
        }

        .achievement-badge.silver {
            background: linear-gradient(135deg, #c0c0c0, #e8e8e8);
            color: #333;
            box-shadow: 0 2px 4px rgba(192, 192, 192, 0.3);
        }

        .achievement-badge.bronze {
            background: linear-gradient(135deg, #cd7f32, #daa520);
            color: white;
            box-shadow: 0 2px 4px rgba(205, 127, 50, 0.3);
        }

        .achievement-badge.legendary {
            background: linear-gradient(135deg, #8a2be2, #ff69b4);
            color: white;
            box-shadow: 0 2px 4px rgba(138, 43, 226, 0.3);
            animation: legendaryGlow 1.5s ease-in-out infinite alternate;
        }

        @keyframes badgeGlow {
            from { box-shadow: 0 2px 4px rgba(255, 215, 0, 0.3); }
            to { box-shadow: 0 4px 8px rgba(255, 215, 0, 0.6); }
        }

        @keyframes legendaryGlow {
            from { box-shadow: 0 2px 4px rgba(138, 43, 226, 0.3); }
            to { box-shadow: 0 6px 12px rgba(138, 43, 226, 0.8); }
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .engine-achievements {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }

        .result-actions {
            display: flex;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }

        .result-actions .btn {
            padding: 10px 20px;
            font-size: 0.9em;
        }

        .encryption-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            border-radius: 8px;
            padding: 20px;
            margin: 10px 0;
        }

        .encryption-success h4 {
            color: #155724;
            margin-bottom: 15px;
        }

        .result-details {
            margin-top: 20px;
        }

        .result-details h5 {
            color: #155724;
            margin-bottom: 10px;
        }

        .result-details pre {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            max-height: 300px;
            overflow-y: auto;
            font-size: 0.85em;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🔐 Advanced Encryption & Stub Generator</h1>
            <p>Comprehensive encryption, stealth features, and stub generation with all algorithms</p>
            <div class="engine-achievements">
                <span class="achievement-badge legendary">21 ALGORITHMS</span>
                <span class="achievement-badge platinum">QUANTUM-READY</span>
                <span class="achievement-badge gold">AES-256</span>
                <span class="achievement-badge gold">CHACHA20</span>
                <span class="achievement-badge gold">CAMELLIA</span>
                <span class="achievement-badge silver">STEALTH</span>
                <span class="achievement-badge bronze">ANTI-ANALYSIS</span>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" data-tab="encryption">Advanced Encryption</button>
            <button class="tab" data-tab="stub">Stub Generator</button>
            <button class="tab" data-tab="ev-cert">EV Certificate</button>
            <button class="tab" data-tab="payload">Payload Integration</button>
            <button class="tab" data-tab="hotpatcher">🔥 Hotpatcher System</button>
        </div>

        <!-- Advanced Encryption Tab -->
        <div id="encryption" class="tab-content active">
            <h2>🔒 Advanced Encryption Generator</h2>
            <p>Generate encrypted files with multiple algorithms, stealth features, and anti-analysis protection.</p>

            <div class="form-grid">
                <div class="form-group">
                    <label>Encryption Algorithms (Select Multiple)</label>
                    <div class="algorithm-grid">
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aes-256-gcm" name="encryption-algorithms" checked>
                            <label for="adv-aes-256-gcm">AES-256-GCM</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aes-256-cbc" name="encryption-algorithms">
                            <label for="adv-aes-256-cbc">AES-256-CBC</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aes-192-gcm" name="encryption-algorithms">
                            <label for="adv-aes-192-gcm">AES-192-GCM</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aes-192-cbc" name="encryption-algorithms">
                            <label for="adv-aes-192-cbc">AES-192-CBC</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aes-128-gcm" name="encryption-algorithms">
                            <label for="adv-aes-128-gcm">AES-128-GCM</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aes-128-cbc" name="encryption-algorithms">
                            <label for="adv-aes-128-cbc">AES-128-CBC</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-chacha20-poly1305" name="encryption-algorithms">
                            <label for="adv-chacha20-poly1305">ChaCha20-Poly1305</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aes-256-ctr" name="encryption-algorithms">
                            <label for="adv-aes-256-ctr">AES-256-CTR</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aria-256-gcm" name="encryption-algorithms">
                            <label for="adv-aria-256-gcm">ARIA-256-GCM</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aria-192-gcm" name="encryption-algorithms">
                            <label for="adv-aria-192-gcm">ARIA-192-GCM</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="adv-aria-128-gcm" name="encryption-algorithms">
                            <label for="adv-aria-128-gcm">ARIA-128-GCM</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="enc-key-size">Key Size</label>
                    <select id="enc-key-size" name="enc-key-size">
                        <option value="128">128-bit</option>
                        <option value="192">192-bit</option>
                        <option value="256" selected>256-bit</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="enc-mode">Encryption Mode</label>
                    <select id="enc-mode" name="enc-mode">
                        <option value="cbc">CBC (Cipher Block Chaining)</option>
                        <option value="gcm">GCM (Galois/Counter Mode)</option>
                        <option value="ctr">CTR (Counter Mode)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="enc-format">Output Format</label>
                    <select id="enc-format" name="enc-format">
                        <option value="base64">Base64</option>
                        <option value="hex">Hexadecimal</option>
                        <option value="binary">Binary</option>
                        <option value="json">JSON</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="enc-extension">File Extension</label>
                    <input type="text" id="enc-extension" name="enc-extension" placeholder=".enc" value=".enc">
                </div>

                <div class="form-group">
                    <label for="enc-obfuscation">Obfuscation</label>
                    <select id="enc-obfuscation" name="enc-obfuscation">
                        <option value="none">None</option>
                        <option value="xor">XOR</option>
                        <option value="base64">Base64</option>
                        <option value="hex">Hex</option>
                        <option value="rot13">ROT13</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Auto-Save Options</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="auto-save-enabled" name="auto-save-options" checked>
                            <label for="auto-save-enabled">Enable Auto-Save</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="save-multiple-extensions" name="auto-save-options" checked>
                            <label for="save-multiple-extensions">Save with Multiple Extensions</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="save-metadata" name="auto-save-options">
                            <label for="save-metadata">Save Metadata Files</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Stealth Features</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="stealth-polymorphic" name="stealth-features">
                        <label for="stealth-polymorphic">Polymorphic</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stealth-metamorphic" name="stealth-features">
                        <label for="stealth-metamorphic">Metamorphic</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stealth-packing" name="stealth-features">
                        <label for="stealth-packing">Packing</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stealth-encryption" name="stealth-features">
                        <label for="stealth-encryption">Additional Encryption</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Anti-Analysis Features</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="anti-debug" name="anti-analysis-features">
                        <label for="anti-debug">Anti-Debug</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="anti-vm" name="anti-analysis-features">
                        <label for="anti-vm">Anti-VM</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="anti-sandbox" name="anti-analysis-features">
                        <label for="anti-sandbox">Anti-Sandbox</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="timing-attack" name="anti-analysis-features">
                        <label for="timing-attack">Timing Attack Resistance</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>File Upload or Text Input</label>
                <div class="file-upload" id="enc-file-upload">
                    <input type="file" id="enc-file" style="display: none;" accept="*/*">
                    <p>📁 Click to upload file or drag & drop</p>
                    <p style="font-size: 0.9em; color: #666;">Or enter text below</p>
                </div>
                <textarea id="enc-text" placeholder="Enter text to encrypt..." rows="4" style="margin-top: 10px;"></textarea>
            </div>

            <button class="btn" id="encrypt-btn">
                🔐 Encrypt with Advanced Features
            </button>

            <div id="enc-result" class="result-section" style="display: none;">
                <h3>Encryption Result</h3>
                <div id="enc-result-content" class="result-content"></div>
            </div>
        </div>

        <!-- Stub Generator Tab -->
        <div id="stub" class="tab-content">
            <h2>🛠️ Comprehensive Stub Generator</h2>
            <p>Generate encrypted stubs with stealth features, anti-analysis, and payload integration.</p>

            <div class="form-grid">
                <div class="form-group">
                    <label for="stub-target">Target File/Data</label>
                    <input type="text" id="stub-target" name="stub-target" placeholder="Path to file or data to embed">
                </div>

                <div class="form-group">
                    <label for="stub-type">Stub Type</label>
                    <select id="stub-type" name="stub-type">
                        <option value="cpp">C++</option>
                        <option value="csharp">C#</option>
                        <option value="python">Python</option>
                        <option value="javascript">JavaScript</option>
                        <option value="powershell">PowerShell</option>
                        <option value="assembly">Assembly</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="stub-encryption">Encryption Method</label>
                    <select id="stub-encryption" name="stub-encryption">
                        <option value="aes-256-cbc">AES-256-CBC</option>
                        <option value="aes-256-gcm">AES-256-GCM</option>
                        <option value="aes-256-ctr">AES-256-CTR (Stream)</option>
                        <option value="aes-256-ofb">AES-256-OFB (Output Feedback)</option>
                        <option value="chacha20-poly1305">ChaCha20-Poly1305</option>
                        <option value="aria-256-cbc">ARIA-256-CBC</option>
                        <option value="double-layer">Double-Layer (AES + ChaCha20)</option>
                        <option value="triple-layer">Triple-Layer (AES + ARIA + ChaCha20)</option>
                        <option value="xor">XOR</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="stub-output-format">Output Format</label>
                    <select id="stub-output-format" name="stub-output-format">
                        <option value="executable">Executable</option>
                        <option value="library">Library</option>
                        <option value="script">Script</option>
                        <option value="source">Source Code</option>
                        <option value="assembly">Assembly</option>
                        <option value="java">Java</option>
                        <option value="cpp">C++</option>
                        <option value="csharp">C#</option>
                        <option value="python">Python</option>
                        <option value="javascript">JavaScript</option>
                        <option value="go">Go</option>
                        <option value="rust">Rust</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="stub-extension">File Extension</label>
                    <select id="stub-extension" name="stub-extension">
                        <option value=".exe">.exe (Windows Executable)</option>
                        <option value=".dll">.dll (Dynamic Library)</option>
                        <option value=".asm">.asm (Assembly)</option>
                        <option value=".s">.s (Assembly Source)</option>
                        <option value=".o">.o (Object File)</option>
                        <option value=".obj">.obj (Object File)</option>
                        <option value=".java">.java (Java Source)</option>
                        <option value=".class">.class (Java Bytecode)</option>
                        <option value=".jar">.jar (Java Archive)</option>
                        <option value=".cpp">.cpp (C++ Source)</option>
                        <option value=".cxx">.cxx (C++ Source)</option>
                        <option value=".cc">.cc (C++ Source)</option>
                        <option value=".c">.c (C Source)</option>
                        <option value=".cs">.cs (C# Source)</option>
                        <option value=".py">.py (Python)</option>
                        <option value=".pyc">.pyc (Python Bytecode)</option>
                        <option value=".js">.js (JavaScript)</option>
                        <option value=".mjs">.mjs (ES Module)</option>
                        <option value=".go">.go (Go Source)</option>
                        <option value=".rs">.rs (Rust Source)</option>
                        <option value=".ps1">.ps1 (PowerShell)</option>
                        <option value=".bat">.bat (Batch)</option>
                        <option value=".cmd">.cmd (Command)</option>
                        <option value=".vbs">.vbs (VBScript)</option>
                        <option value=".xll">.xll (Excel Add-in)</option>
                        <option value=".lnk">.lnk (Shortcut)</option>
                        <option value=".sys">.sys (System Driver)</option>
                        <option value=".drv">.drv (Driver)</option>
                        <option value=".ocx">.ocx (ActiveX)</option>
                        <option value=".cpl">.cpl (Control Panel)</option>
                        <option value=".scr">.scr (Screensaver)</option>
                        <option value=".com">.com (Command)</option>
                        <option value=".pif">.pif (Program Info)</option>
                        <option value=".msi">.msi (Installer)</option>
                        <option value=".bin">.bin (Binary)</option>
                        <option value=".dat">.dat (Data)</option>
                        <option value=".stub">.stub (Stub)</option>
                        <option value=".payload">.payload (Payload)</option>
                        <option value=".secure">.secure (Secure)</option>
                        <option value=".locked">.locked (Locked)</option>
                        <option value=".crypt">.crypt (Crypt)</option>
                        <option value=".enc">.enc (Encrypted)</option>
                        <option value=".raw">.raw (Raw Data)</option>
                        <option value=".hex">.hex (Hexadecimal)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="stub-payload">Payload Integration</label>
                    <textarea id="stub-payload" name="stub-payload" placeholder="Optional payload to integrate..." rows="3"></textarea>
                </div>

                <!-- EV Certificate Integration -->
                <div class="form-group">
                    <label>EV Certificate Integration</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="ev-cert-enable" name="ev-cert-enable">
                            <span class="checkmark"></span>
                            Enable EV Certificate Signing
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="ev-cert-encrypt" name="ev-cert-encrypt">
                            <span class="checkmark"></span>
                            Encrypt with EV Certificate
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="ev-cert-verify" name="ev-cert-verify">
                            <span class="checkmark"></span>
                            Verify EV Certificate Chain
                        </label>
                    </div>
                </div>

                <!-- Hotpatcher System Integration -->
                <div class="form-group">
                    <label>Hotpatcher System Integration</label>
                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="hotpatch-enable" name="hotpatch-enable">
                            <span class="checkmark"></span>
                            Enable Hot Patching
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="hotpatch-runtime" name="hotpatch-runtime">
                            <span class="checkmark"></span>
                            Runtime Hot Patching
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="hotpatch-memory" name="hotpatch-memory">
                            <span class="checkmark"></span>
                            Memory-based Patching
                        </label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Stealth Features</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-stealth-polymorphic" name="stub-stealth-features">
                        <label for="stub-stealth-polymorphic">Polymorphic</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-stealth-metamorphic" name="stub-stealth-features">
                        <label for="stub-stealth-metamorphic">Metamorphic</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-stealth-packing" name="stub-stealth-features">
                        <label for="stub-stealth-packing">Packing</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-stealth-encryption" name="stub-stealth-features">
                        <label for="stub-stealth-encryption">Stealth Encryption</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-stealth-obfuscation" name="stub-stealth-features">
                        <label for="stub-stealth-obfuscation">Obfuscation</label>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label>Anti-Analysis Features</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-anti-debug" name="stub-anti-analysis">
                        <label for="stub-anti-debug">Anti-Debug</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-anti-vm" name="stub-anti-analysis">
                        <label for="stub-anti-vm">Anti-VM</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-anti-sandbox" name="stub-anti-analysis">
                        <label for="stub-anti-sandbox">Anti-Sandbox</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-timing-attack" name="stub-anti-analysis">
                        <label for="stub-timing-attack">Timing Attack Resistance</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="stub-anti-disassembly" name="stub-anti-analysis">
                        <label for="stub-anti-disassembly">Anti-Disassembly</label>
                    </div>
                </div>
            </div>

            <button class="btn" onclick="generateStub()">
                🛠️ Generate Advanced Stub
            </button>

            <div id="stub-result" class="result-section" style="display: none;">
                <h3>Stub Generation Result</h3>
                <div id="stub-result-content" class="result-content"></div>
            </div>
        </div>

        <!-- EV Certificate Tab -->
        <div id="ev-cert" class="tab-content">
            <h2>📜 EV Certificate Operations</h2>
            <p>Encrypt, decrypt, sign, and verify using EV Certificate-based keys.</p>

            <div class="form-grid">
                <div class="form-group">
                    <label for="cert-type">Certificate Type</label>
                    <select id="cert-type" name="cert-type">
                        <option value="code-signing">Code Signing</option>
                        <option value="ssl-tls">SSL/TLS</option>
                        <option value="email">Email</option>
                        <option value="document">Document</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="cert-algorithm">Algorithm</label>
                    <select id="cert-algorithm" name="cert-algorithm">
                        <option value="aes-256-gcm">AES-256-GCM</option>
                        <option value="aes-256-cbc">AES-256-CBC</option>
                        <option value="aes-256-ctr">AES-256-CTR (Stream)</option>
                        <option value="aes-256-ofb">AES-256-OFB (Output Feedback)</option>
                        <option value="chacha20-poly1305">ChaCha20-Poly1305</option>
                        <option value="aria-256-cbc">ARIA-256-CBC</option>
                        <option value="double-layer">Double-Layer (AES + ChaCha20)</option>
                        <option value="triple-layer">Triple-Layer (AES + ARIA + ChaCha20)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="cert-format">Format</label>
                    <select id="cert-format" name="cert-format">
                        <option value="base64">Base64</option>
                        <option value="hex">Hexadecimal</option>
                        <option value="binary">Binary</option>
                        <option value="json">JSON</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="cert-extension">File Extension</label>
                    <input type="text" id="cert-extension" name="cert-extension" placeholder=".enc" value=".enc">
                </div>
            </div>

            <div class="form-group">
                <label>Certificate Operations</label>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" onclick="performEVCertOperation('encrypt')">🔐 Encrypt</button>
                    <button class="btn" onclick="performEVCertOperation('decrypt')">🔓 Decrypt</button>
                    <button class="btn" onclick="performEVCertOperation('sign')">✍️ Sign</button>
                    <button class="btn" onclick="performEVCertOperation('verify')">✅ Verify</button>
                </div>
            </div>

            <div class="form-group">
                <label>File Upload or Text Input</label>
                <div class="file-upload" onclick="document.getElementById('cert-file').click()">
                    <input type="file" id="cert-file" style="display: none;" accept="*/*">
                    <p>📁 Click to upload file or drag & drop</p>
                    <p style="font-size: 0.9em; color: #666;">Or enter text below</p>
                </div>
                <textarea id="cert-text" placeholder="Enter text for certificate operations..." rows="4" style="margin-top: 10px;"></textarea>
            </div>

            <div id="cert-result" class="result-section" style="display: none;">
                <h3>Certificate Operation Result</h3>
                <div id="cert-result-content" class="result-content"></div>
            </div>
        </div>

        <!-- Payload Integration Tab -->
        <div id="payload" class="tab-content">
            <h2>🎯 Payload Integration</h2>
            <p>Integrate payloads with encryption, stealth features, and anti-analysis protection.</p>

            <div class="feature-grid">
                <div class="feature-card">
                    <h4>🔐 Encrypted Payloads</h4>
                    <p>Integrate payloads with multiple encryption algorithms and key management.</p>
                </div>
                <div class="feature-card">
                    <h4>🥷 Stealth Integration</h4>
                    <p>Apply polymorphic, metamorphic, and packing techniques to payloads.</p>
                </div>
                <div class="feature-card">
                    <h4>🛡️ Anti-Analysis</h4>
                    <p>Protect payloads with anti-debug, anti-VM, and anti-sandbox features.</p>
                </div>
                <div class="feature-card">
                    <h4>📦 Multi-Format</h4>
                    <p>Support various payload formats and output extensions.</p>
                </div>
            </div>

            <div class="form-grid">
                <div class="form-group">
                    <label for="payload-type">Payload Type</label>
                    <select id="payload-type" name="payload-type">
                        <option value="executable">Executable</option>
                        <option value="script">Script</option>
                        <option value="library">Library</option>
                        <option value="data">Data</option>
                        <option value="custom">Custom</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="payload-encryption">Encryption</label>
                    <select id="payload-encryption" name="payload-encryption">
                        <option value="aes-256-gcm">AES-256-GCM</option>
                        <option value="aes-256-cbc">AES-256-CBC</option>
                        <option value="aes-256-ctr">AES-256-CTR (Stream)</option>
                        <option value="aes-256-ofb">AES-256-OFB (Output Feedback)</option>
                        <option value="aria-256-cbc">ARIA-256-CBC</option>
                        <option value="chacha20-poly1305">ChaCha20-Poly1305</option>
                        <option value="double-layer">Double-Layer (AES + ChaCha20)</option>
                        <option value="triple-layer">Triple-Layer (AES + ARIA + ChaCha20)</option>
                        <option value="aria-256-ctr">ARIA-256-CTR</option>
                        <option value="aria-192-ctr">ARIA-192-CTR</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="payload-format">Output Format</label>
                    <select id="payload-format" name="payload-format">
                        <option value="executable">Executable</option>
                        <option value="library">Library</option>
                        <option value="script">Script</option>
                        <option value="source">Source Code</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="payload-extension">File Extension</label>
                    <input type="text" id="payload-extension" name="payload-extension" placeholder=".exe" value=".exe">
                </div>
            </div>

            <div class="form-group">
                <label>Payload File Upload</label>
                <div class="file-upload" onclick="document.getElementById('payload-file').click()">
                    <input type="file" id="payload-file" style="display: none;" accept="*/*">
                    <p>📁 Click to upload payload file</p>
                    <p style="font-size: 0.9em; color: #666;">Supports all file types</p>
                </div>
            </div>

            <button class="btn" onclick="integratePayload()">
                🎯 Integrate Payload with Advanced Features
            </button>

            <div id="payload-result" class="result-section" style="display: none;">
                <h3>Payload Integration Result</h3>
                <div id="payload-result-content" class="result-content"></div>
            </div>
        </div>

        <!-- Hotpatcher System Tab -->
        <div id="hotpatcher" class="tab-content">
            <h2>🔥 Hotpatcher System - Payload Injection Between Layers</h2>
            <p>Inject payloads between encryption layers with advanced hotpatcher technology. Combine multiple payloads with different injection points.</p>

            <div class="form-grid">
                <div class="form-group">
                    <label for="hotpatcher-file">Target File</label>
                    <input type="file" id="hotpatcher-file" accept="*/*">
                </div>

                <div class="form-group">
                    <label for="hotpatcher-encryption">Encryption Method</label>
                    <select id="hotpatcher-encryption" name="hotpatcher-encryption">
                        <option value="aes-256-gcm">AES-256-GCM</option>
                        <option value="aes-256-cbc">AES-256-CBC</option>
                        <option value="aes-256-ctr">AES-256-CTR (Stream)</option>
                        <option value="aes-256-ofb">AES-256-OFB (Output Feedback)</option>
                        <option value="chacha20-poly1305">ChaCha20-Poly1305</option>
                        <option value="aria-256-cbc">ARIA-256-CBC</option>
                        <option value="double-layer">Double-Layer (AES + ChaCha20)</option>
                        <option value="triple-layer">Triple-Layer (AES + ARIA + ChaCha20)</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Payload Types</label>
                    <div class="checkbox-group" id="hotpatcher-payloads">
                        <div class="checkbox-item">
                            <input type="checkbox" id="payload-irc-bot" name="hotpatcher-payloads" value="irc-bot" checked>
                            <label for="payload-irc-bot">IRC Bot</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="payload-http-bot" name="hotpatcher-payloads" value="http-bot" checked>
                            <label for="payload-http-bot">HTTP Bot</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="payload-keylogger" name="hotpatcher-payloads" value="keylogger">
                            <label for="payload-keylogger">Keylogger</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="payload-persistence" name="hotpatcher-payloads" value="persistence">
                            <label for="payload-persistence">Persistence</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="payload-backdoor" name="hotpatcher-payloads" value="backdoor">
                            <label for="payload-backdoor">Backdoor</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="payload-stealer" name="hotpatcher-payloads" value="stealer">
                            <label for="payload-stealer">Stealer</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Injection Points</label>
                    <div class="checkbox-group" id="hotpatcher-injection-points">
                        <div class="checkbox-item">
                            <input type="checkbox" id="injection-beginning" name="injection-points" value="beginning" checked>
                            <label for="injection-beginning">Beginning</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="injection-middle" name="injection-points" value="middle" checked>
                            <label for="injection-middle">Middle</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="injection-end" name="injection-points" value="end">
                            <label for="injection-end">End</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="injection-layered" name="injection-points" value="layered">
                            <label for="injection-layered">Between Layers</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Stealth Features</label>
                    <div class="checkbox-group" id="hotpatcher-stealth">
                        <div class="checkbox-item">
                            <input type="checkbox" id="stealth-polymorphic-hotpatcher" name="stealth-features" value="polymorphic" checked>
                            <label for="stealth-polymorphic-hotpatcher">Polymorphic</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="stealth-metamorphic-hotpatcher" name="stealth-features" value="metamorphic">
                            <label for="stealth-metamorphic-hotpatcher">Metamorphic</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="stealth-packing-hotpatcher" name="stealth-features" value="packing" checked>
                            <label for="stealth-packing-hotpatcher">Packing</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="stealth-obfuscation-hotpatcher" name="stealth-features" value="obfuscation" checked>
                            <label for="stealth-obfuscation-hotpatcher">Obfuscation</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Anti-Analysis</label>
                    <div class="checkbox-group" id="hotpatcher-anti-analysis">
                        <div class="checkbox-item">
                            <input type="checkbox" id="anti-debug-hotpatcher" name="anti-analysis" value="anti-debug" checked>
                            <label for="anti-debug-hotpatcher">Anti-Debug</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="anti-vm-hotpatcher" name="anti-analysis" value="anti-vm" checked>
                            <label for="anti-vm-hotpatcher">Anti-VM</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="anti-sandbox-hotpatcher" name="anti-analysis" value="anti-sandbox" checked>
                            <label for="anti-sandbox-hotpatcher">Anti-Sandbox</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="timing-attack-hotpatcher" name="anti-analysis" value="timing-attack">
                            <label for="timing-attack-hotpatcher">Timing Attack Resistance</label>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Fileless Mode</label>
                    <div class="checkbox-group" id="hotpatcher-fileless">
                        <div class="checkbox-item">
                            <input type="checkbox" id="fileless-memory-only" name="fileless-options" value="memory-only" checked>
                            <label for="fileless-memory-only">Memory-Only Storage</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fileless-system-entropy" name="fileless-options" value="system-entropy" checked>
                            <label for="fileless-system-entropy">System Entropy</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="fileless-auto-cleanup" name="fileless-options" value="auto-cleanup" checked>
                            <label for="fileless-auto-cleanup">Auto Cleanup</label>
                        </div>
                    </div>
                </div>
            </div>

            <div class="button-group">
                <button onclick="executeHotpatcher()" class="btn btn-primary">
                    🔥 Execute Hotpatcher
                </button>
                <button onclick="extractPayloads()" class="btn btn-secondary">
                    🔍 Extract Payloads
                </button>
                <button onclick="testHotpatcher()" class="btn btn-info">
                    🧪 Test Hotpatcher
                </button>
            </div>

            <div id="hotpatcher-result" class="result-section" style="display: none;">
                <h3>🔥 Hotpatcher Results</h3>
                <div id="hotpatcher-result-content" class="result-content"></div>
            </div>

            <div class="feature-grid">
                <div class="feature-card">
                    <h3>🔥 Multi-Payload Injection</h3>
                    <p>Inject multiple payloads (IRC Bot, HTTP Bot, Keylogger, Persistence) at different points in the encrypted data.</p>
                </div>
                <div class="feature-card">
                    <h3>🔐 Layer-Aware Injection</h3>
                    <p>Inject payloads between encryption layers for maximum stealth and security.</p>
                </div>
                <div class="feature-card">
                    <h3>🔍 Payload Extraction</h3>
                    <p>Extract and verify injected payloads with signature verification and timestamp tracking.</p>
                </div>
                <div class="feature-card">
                    <h3>🧠 Memory-Only Operations</h3>
                    <p>All operations use memory-only storage with automatic cleanup for maximum security.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Utility Functions
        window.showError = function(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `
                    <div class="error-message" style="color: #dc3545; background: #f8d7da; border: 1px solid #f5c6cb; padding: 15px; border-radius: 8px;">
                        <h4>❌ Error</h4>
                        <p>${message}</p>
                    </div>
                `;
                element.parentElement.style.display = 'block';
            } else {
                alert('Error: ' + message);
            }
        }

        window.showLoading = function(elementId, message) {
            const element = document.getElementById(elementId);
            if (element) {
                element.innerHTML = `
                    <div class="loading-message" style="color: #17a2b8; background: #d1ecf1; border: 1px solid #bee5eb; padding: 15px; border-radius: 8px;">
                        <h4>⏳ Loading...</h4>
                        <p>${message}</p>
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: 100%; animation: pulse 1.5s ease-in-out infinite;"></div>
                        </div>
                    </div>
                `;
                element.parentElement.style.display = 'block';
            }
        }

        window.showResult = function(type, message) {
            let alertMessage = '';
            switch(type) {
                case 'error':
                    alertMessage = '❌ Error: ' + message;
                    break;
                case 'success':
                    alertMessage = '✅ Success: ' + message;
                    break;
                case 'warning':
                    alertMessage = '⚠️ Warning: ' + message;
                    break;
                default:
                    alertMessage = message;
            }
            alert(alertMessage);
        }

        window.downloadFile = function(url, filename) {
            try {
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } catch (error) {
                showError('hotpatcher-result-content', 'Download failed: ' + error.message);
            }
        }

        // Enhanced file saving with multiple format support
        window.saveEncryptionResult = function(data, originalFileName, encryptionType, format) {
            try {
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const baseName = originalFileName ? originalFileName.split('.')[0] : 'encrypted_file';
                
                // Generate multiple file formats
                const filesToSave = [];
                
                // 1. Main encrypted file
                const encryptedExtension = document.getElementById('enc-extension')?.value || '.enc';
                filesToSave.push({
                    data: data.encryptedData || data.data,
                    filename: `${baseName}_${encryptionType}_${timestamp}${encryptedExtension}`,
                    type: 'encrypted'
                });
                
                // 2. Metadata file (if enabled)
                const saveMetadata = document.getElementById('save-metadata')?.checked;
                if (data.metadata && saveMetadata) {
                    filesToSave.push({
                        data: JSON.stringify(data.metadata, null, 2),
                        filename: `${baseName}_metadata_${timestamp}.json`,
                        type: 'metadata'
                    });
                }
                
                // 3. Key file (if available)
                if (data.key) {
                    filesToSave.push({
                        data: data.key,
                        filename: `${baseName}_key_${timestamp}.key`,
                        type: 'key'
                    });
                }
                
                // 4. Configuration file
                if (data.config) {
                    filesToSave.push({
                        data: JSON.stringify(data.config, null, 2),
                        filename: `${baseName}_config_${timestamp}.json`,
                        type: 'config'
                    });
                }
                
                // 5. Log file
                if (data.log) {
                    filesToSave.push({
                        data: data.log,
                        filename: `${baseName}_log_${timestamp}.txt`,
                        type: 'log'
                    });
                }
                
                // Save all files
                filesToSave.forEach((file, index) => {
                    setTimeout(() => {
                        const blob = new Blob([file.data], { type: 'application/octet-stream' });
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = file.filename;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    }, index * 500); // Stagger downloads
                });
                
                // Show success message
                showResult('success', `Saved ${filesToSave.length} files to Downloads folder`);
                
            } catch (error) {
                showError('enc-result-content', 'Save failed: ' + error.message);
            }
        }

        // Auto-save to desktop functionality
        window.autoSaveToDesktop = function(data, originalFileName, encryptionType) {
            try {
                const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                const baseName = originalFileName ? originalFileName.split('.')[0] : 'encrypted_file';
                
                // Create desktop path (Windows)
                const desktopPath = `${baseName}_${encryptionType}_${timestamp}`;
                
                // Generate different working extensions
                const extensions = [
                    '.exe', '.dll', '.sys', '.dat', '.tmp', '.log', '.cfg', '.ini',
                    '.txt', '.bin', '.raw', '.img', '.iso', '.zip', '.rar', '.7z'
                ];
                
                // Save with multiple extensions for stealth
                extensions.forEach((ext, index) => {
                    setTimeout(() => {
                        const blob = new Blob([data.encryptedData || data.data], { 
                            type: 'application/octet-stream' 
                        });
                        const url = URL.createObjectURL(blob);
                        const link = document.createElement('a');
                        link.href = url;
                        link.download = `${desktopPath}${ext}`;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        URL.revokeObjectURL(url);
                    }, index * 200);
                });
                
                showResult('success', `Auto-saved with ${extensions.length} different extensions`);
                
            } catch (error) {
                showError('enc-result-content', 'Auto-save failed: ' + error.message);
            }
        }

        // Tab switching with robust error handling
        function switchTab(tabName, clickedElement = null) {
            try {
                // Wait for DOM to be ready
                if (document.readyState === 'loading') {
                    console.log('DOM not ready, retrying tab switch...');
                    setTimeout(() => switchTab(tabName, clickedElement), 100);
                    return;
                }
                
                // Hide all tab contents
                const tabContents = document.querySelectorAll('.tab-content');
                if (tabContents.length === 0) {
                    console.error('No tab content elements found');
                    return;
                }
                
                tabContents.forEach(content => {
                    content.classList.remove('active');
                });
                
                // Remove active class from all tabs
                const navTabs = document.querySelectorAll('.nav-tab');
                if (navTabs.length === 0) {
                    console.error('No nav tab elements found');
                    return;
                }
                
                navTabs.forEach(tab => {
                    tab.classList.remove('active');
                });
                
                // Show selected tab content
                const targetContent = document.getElementById(tabName);
                if (!targetContent) {
                    console.error(`Tab content element '${tabName}' not found`);
                    return;
                }
                targetContent.classList.add('active');
                
                // Add active class to clicked tab
                if (clickedElement) {
                    clickedElement.classList.add('active');
                } else {
                    // Find the tab button that corresponds to this tab
                    const targetTab = document.querySelector(`[onclick*="switchTab('${tabName}')"]`);
                    if (targetTab) {
                        targetTab.classList.add('active');
                    }
                }
                
                console.log(`Successfully switched to tab: ${tabName}`);
            } catch (error) {
                console.error('Error switching tab:', error);
            }
        }

        // Handle URL hash navigation and tab event listeners
        window.addEventListener('DOMContentLoaded', function() {
            // Add a small delay to ensure all elements are fully loaded
            setTimeout(() => {
                // Add event listeners to all tab buttons
                const tabButtons = document.querySelectorAll('.tab[data-tab]');
                tabButtons.forEach(button => {
                    button.addEventListener('click', function(e) {
                        e.preventDefault();
                        const tabName = this.getAttribute('data-tab');
                        console.log('Tab button clicked:', tabName);
                        switchTab(tabName, this);
                    });
                });
                
                // Handle URL hash navigation
                const hash = window.location.hash.substring(1);
                if (hash && document.getElementById(hash)) {
                    console.log('URL hash detected:', hash);
                    switchTab(hash);
                }
                
                // Debug: Check if enc-file element exists on page load
                const encFileElement = document.getElementById('enc-file');
                console.log('🔍 Page load check - enc-file element exists:', !!encFileElement);
                if (encFileElement) {
                    console.log('🔍 enc-file element details:', {
                        id: encFileElement.id,
                        type: encFileElement.type,
                        parent: encFileElement.parentElement?.id,
                        visible: encFileElement.offsetParent !== null
                    });
                }
            }, 100);
        });

        // Get selected encryption algorithms from checkboxes
        function getSelectedAlgorithms() {
            const algorithms = [];
            const algorithmCheckboxes = [
                'adv-aes-256-gcm', 'adv-aes-256-cbc', 'adv-aes-192-gcm', 'adv-aes-192-cbc', 
                'adv-aes-128-gcm', 'adv-aes-128-cbc', 'adv-aes-256-ctr', 'adv-chacha20-poly1305',
                'adv-aria-256-gcm', 'adv-aria-192-gcm', 'adv-aria-128-gcm'
            ];
            
            algorithmCheckboxes.forEach(algorithm => {
                const checkbox = document.getElementById(algorithm);
                if (checkbox && checkbox.checked) {
                    // Remove 'adv-' prefix for the actual algorithm name
                    const cleanAlgorithm = algorithm.replace('adv-', '');
                    algorithms.push(cleanAlgorithm);
                }
            });
            
            return algorithms;
        }
        
        // Get selected stealth features
        function getSelectedStealthFeatures() {
            const features = {
                polymorphic: document.getElementById('stealth-polymorphic')?.checked || false,
                metamorphic: document.getElementById('stealth-metamorphic')?.checked || false,
                packing: document.getElementById('stealth-packing')?.checked || false,
                encryption: document.getElementById('stealth-encryption')?.checked || false,
                antiDebug: document.getElementById('anti-debug')?.checked || false,
                antiVM: document.getElementById('anti-vm')?.checked || false,
                antiSandbox: document.getElementById('anti-sandbox')?.checked || false,
                timingAttack: document.getElementById('timing-attack')?.checked || false
            };
            return features;
        }

        // Advanced Encryption
        async function performAdvancedEncryption() {
            // Wait for DOM to be ready
            if (document.readyState === 'loading') {
                showResult('error', 'Page is still loading. Please wait and try again.');
                return;
            }
            
            // Ensure we're on the encryption tab
            const encryptionTab = document.getElementById('encryption');
            if (!encryptionTab || !encryptionTab.classList.contains('active')) {
                console.log('Not on encryption tab, switching to it...');
                switchTab('encryption');
                // Wait a bit for tab switch to complete
                await new Promise(resolve => setTimeout(resolve, 200));
            }
            
            const selectedAlgorithms = getSelectedAlgorithms();
            const selectedStealthFeatures = getSelectedStealthFeatures();
            const keySize = document.getElementById('enc-key-size').value;
            const mode = document.getElementById('enc-mode').value;
            const format = document.getElementById('enc-format').value;
            const extension = document.getElementById('enc-extension').value;
            const obfuscation = document.getElementById('enc-obfuscation').value;
            
            if (selectedAlgorithms.length === 0) {
                showResult('error', 'No encryption algorithms selected! Please select at least one algorithm.');
                return;
            }
            
            // Convert stealth features object to arrays for backward compatibility
            const stealthFeatures = Object.entries(selectedStealthFeatures)
                .filter(([key, value]) => value && ['polymorphic', 'metamorphic', 'packing', 'encryption'].includes(key))
                .map(([key]) => key);
                
            const antiAnalysisFeatures = Object.entries(selectedStealthFeatures)
                .filter(([key, value]) => value && ['antiDebug', 'antiVM', 'antiSandbox', 'timingAttack'].includes(key))
                .map(([key]) => key.replace('anti', 'anti-').toLowerCase());
            
            // Wait for elements to be available with retry logic
            let fileInput, textInput;
            let attempts = 0;
            const maxAttempts = 15; // Increased attempts
            
            while (attempts < maxAttempts) {
                fileInput = document.getElementById('enc-file');
                textInput = document.getElementById('enc-text');
                
                if (fileInput && textInput) {
                    console.log(`✅ Elements found after ${attempts + 1} attempts`);
                    break;
                }
                
                console.log(`Attempt ${attempts + 1}/${maxAttempts}: File input: ${!!fileInput}, Text input: ${!!textInput}`);
                
                // Debug: Check if the parent container exists
                const fileUploadContainer = document.getElementById('enc-file-upload');
                console.log(`File upload container exists: ${!!fileUploadContainer}`);
                if (fileUploadContainer) {
                    console.log(`Container children:`, fileUploadContainer.children.length);
                    console.log(`Container innerHTML:`, fileUploadContainer.innerHTML.substring(0, 100));
                }
                
                // Debug: Check all file inputs in the document
                const allFileInputs = document.querySelectorAll('input[type="file"]');
                console.log(`Total file inputs found: ${allFileInputs.length}`);
                allFileInputs.forEach((input, index) => {
                    console.log(`File input ${index}: id="${input.id}", parent="${input.parentElement?.id || 'no parent id'}"`);
                });
                
                // Debug: Check if we're on the right tab
                const activeTab = document.querySelector('.tab-content.active');
                console.log(`Active tab: ${activeTab?.id || 'none'}`);
                
                // Debug: Check if the encryption tab exists and is visible
                const encryptionTab = document.getElementById('encryption');
                console.log(`Encryption tab exists: ${!!encryptionTab}`);
                if (encryptionTab) {
                    console.log(`Encryption tab classes: ${encryptionTab.className}`);
                    console.log(`Encryption tab style display: ${encryptionTab.style.display}`);
                }
                
                await new Promise(resolve => setTimeout(resolve, 150)); // Slightly longer delay
                attempts++;
            }
            
            console.log('DOM ready state:', document.readyState);
            console.log('File input element:', fileInput);
            console.log('Text input element:', textInput);
            
            if (!fileInput) {
                console.log('File input not found, attempting to create it...');
                const fileUploadContainer = document.getElementById('enc-file-upload');
                if (fileUploadContainer) {
                    // Create the file input element
                    const newFileInput = document.createElement('input');
                    newFileInput.type = 'file';
                    newFileInput.id = 'enc-file';
                    newFileInput.style.display = 'none';
                    newFileInput.accept = '*/*';
                    fileUploadContainer.insertBefore(newFileInput, fileUploadContainer.firstChild);
                    fileInput = newFileInput;
                    console.log('✅ File input element created successfully');
                } else {
                    // Try to find any file upload container or create one
                    console.log('File upload container not found, creating one...');
                    const encryptionTab = document.getElementById('encryption');
                    if (encryptionTab) {
                        // Create a new file upload section
                        const fileUploadSection = document.createElement('div');
                        fileUploadSection.className = 'form-group';
                        fileUploadSection.innerHTML = `
                            <label>File Upload or Text Input</label>
                            <div class="file-upload" id="enc-file-upload">
                                <input type="file" id="enc-file" style="display: none;" accept="*/*">
                                <p>📁 Click to upload file or drag & drop</p>
                                <p style="font-size: 0.9em; color: #666;">Or enter text below</p>
                            </div>
                        `;
                        
                        // Insert before the encrypt button
                        const encryptBtn = document.getElementById('encrypt-btn');
                        if (encryptBtn) {
                            encryptBtn.parentNode.insertBefore(fileUploadSection, encryptBtn);
                            fileInput = document.getElementById('enc-file');
                            console.log('✅ File upload section created successfully');
                        } else {
                            showResult('error', 'Cannot create file input - encrypt button not found!');
                            return;
                        }
                    } else {
                        showResult('error', 'File input element not found! Please ensure you are on the Advanced Encryption tab.');
                        console.error('enc-file element not found in DOM after', maxAttempts, 'attempts');
                        return;
                    }
                }
            }
            
            if (!textInput) {
                console.log('Text input not found, attempting to create it...');
                const encryptionTab = document.getElementById('encryption');
                if (encryptionTab) {
                    // Create a new text input
                    const textInputSection = document.createElement('div');
                    textInputSection.innerHTML = `
                        <textarea id="enc-text" placeholder="Enter text to encrypt..." rows="4" style="margin-top: 10px; width: 100%; background: rgba(15, 21, 48, 0.8); color: #e6e9ef; border: 1px solid #263056; border-radius: 8px; padding: 0.75rem; font-size: 0.9rem;"></textarea>
                    `;
                    
                    // Insert after the file upload section
                    const fileUploadSection = document.getElementById('enc-file-upload');
                    if (fileUploadSection) {
                        fileUploadSection.parentNode.insertBefore(textInputSection, fileUploadSection.nextSibling);
                        textInput = document.getElementById('enc-text');
                        console.log('✅ Text input element created successfully');
                    } else {
                        showResult('error', 'Text input element not found! Please ensure you are on the Advanced Encryption tab.');
                        console.error('enc-text element not found in DOM after', maxAttempts, 'attempts');
                        return;
                    }
                } else {
                    showResult('error', 'Text input element not found! Please ensure you are on the Advanced Encryption tab.');
                    console.error('enc-text element not found in DOM after', maxAttempts, 'attempts');
                    return;
                }
            }
            
            const file = fileInput.files[0];
            const text = textInput.value;
            
            console.log('File input:', fileInput);
            console.log('Text input:', textInput);
            console.log('File:', file);
            console.log('Text:', text);
            
            if (!file && !text) {
                showResult('error', 'Please upload a file or enter text to encrypt.');
                return;
            }
            
            // Check file size if file is uploaded
            if (file && !checkFileSize(file, file.name)) {
                return;
            }
            
            const formData = new FormData();
            if (file) {
                formData.append('file', file);
            } else {
                formData.append('data', text);
            }
            
            formData.append('algorithm', selectedAlgorithms[0]); // Use first selected algorithm
            formData.append('keySize', keySize);
            formData.append('mode', mode);
            formData.append('format', format);
            formData.append('extension', extension);
            formData.append('obfuscation', obfuscation);
            formData.append('stealth', stealthFeatures.join(','));
            formData.append('antiAnalysis', antiAnalysisFeatures.join(','));
            
            try {
                const response = await fetch('/advanced-encrypt', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('enc-result').style.display = 'block';
                    document.getElementById('enc-result-content').innerHTML = `
                        <div class="encryption-success">
                            <h4>✅ Encryption Successful!</h4>
                            <div class="result-actions">
                                <button onclick="saveEncryptionResult(result.data, '${file ? file.name : 'text_data'}', '${selectedAlgorithms.join('_')}', '${format}')" class="btn btn-success">
                                    💾 Save All Files
                                </button>
                                <button onclick="autoSaveToDesktop(result.data, '${file ? file.name : 'text_data'}', '${selectedAlgorithms.join('_')}')" class="btn btn-primary">
                                    🖥️ Auto-Save to Desktop
                                </button>
                                <button onclick="downloadFile('data:text/plain;charset=utf-8,' + encodeURIComponent(JSON.stringify(result.data, null, 2)), 'encryption_result_${new Date().toISOString().replace(/[:.]/g, '-')}.json')" class="btn btn-secondary">
                                    📄 Download JSON
                                </button>
                            </div>
                            <div class="result-details">
                                <h5>Encryption Details:</h5>
                                <pre>${JSON.stringify(result.data, null, 2)}</pre>
                            </div>
                        </div>
                    `;
                    
                    // Auto-save the result if enabled
                    const autoSaveEnabled = document.getElementById('auto-save-enabled')?.checked;
                    const saveMultipleExtensions = document.getElementById('save-multiple-extensions')?.checked;
                    
                    if (autoSaveEnabled) {
                        setTimeout(() => {
                            if (saveMultipleExtensions) {
                                autoSaveToDesktop(result.data, file ? file.name : 'text_data', selectedAlgorithms.join('_'));
                            } else {
                                saveEncryptionResult(result.data, file ? file.name : 'text_data', selectedAlgorithms.join('_'), format);
                            }
                        }, 1000);
                    }
                } else {
                    showError('enc-result-content', 'Encryption failed: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Stub Generation
        async function generateStub() {
            const target = document.getElementById('stub-target').value;
            const stubType = document.getElementById('stub-type').value;
            const encryptionMethod = document.getElementById('stub-encryption').value;
            const outputFormat = document.getElementById('stub-output-format').value;
            const extension = document.getElementById('stub-extension').value;
            const payload = document.getElementById('stub-payload').value;
            
            // Get stealth features
            const stealthFeatures = [];
            if (document.getElementById('stub-stealth-polymorphic').checked) stealthFeatures.push('polymorphic');
            if (document.getElementById('stub-stealth-metamorphic').checked) stealthFeatures.push('metamorphic');
            if (document.getElementById('stub-stealth-packing').checked) stealthFeatures.push('packing');
            if (document.getElementById('stub-stealth-encryption').checked) stealthFeatures.push('encryption');
            if (document.getElementById('stub-stealth-obfuscation').checked) stealthFeatures.push('obfuscation');
            
            // Get anti-analysis features
            const antiAnalysisFeatures = [];
            if (document.getElementById('stub-anti-debug').checked) antiAnalysisFeatures.push('anti-debug');
            if (document.getElementById('stub-anti-vm').checked) antiAnalysisFeatures.push('anti-vm');
            if (document.getElementById('stub-anti-sandbox').checked) antiAnalysisFeatures.push('anti-sandbox');
            if (document.getElementById('stub-timing-attack').checked) antiAnalysisFeatures.push('timing-attack');
            if (document.getElementById('stub-anti-disassembly').checked) antiAnalysisFeatures.push('anti-disassembly');
            
            // Get EV Certificate features
            const evCertFeatures = [];
            if (document.getElementById('ev-cert-enable').checked) evCertFeatures.push('ev-cert-signing');
            if (document.getElementById('ev-cert-encrypt').checked) evCertFeatures.push('ev-cert-encryption');
            if (document.getElementById('ev-cert-verify').checked) evCertFeatures.push('ev-cert-verification');
            
            // Get Hotpatcher features
            const hotpatchFeatures = [];
            if (document.getElementById('hotpatch-enable').checked) hotpatchFeatures.push('hot-patching');
            if (document.getElementById('hotpatch-runtime').checked) hotpatchFeatures.push('runtime-patching');
            if (document.getElementById('hotpatch-memory').checked) hotpatchFeatures.push('memory-patching');
            
            if (!target) {
                alert('Please specify a target file or data.');
                return;
            }
            
            const requestData = {
                target: target,
                stubType: stubType,
                encryptionMethod: encryptionMethod,
                stealthFeatures: stealthFeatures,
                antiAnalysisFeatures: antiAnalysisFeatures,
                evCertFeatures: evCertFeatures,
                hotpatchFeatures: hotpatchFeatures,
                payload: payload,
                outputFormat: outputFormat,
                extension: extension,
                customOptions: {}
            };
            
            try {
                const response = await fetch('/generate-stub', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('stub-result').style.display = 'block';
                    document.getElementById('stub-result-content').textContent = JSON.stringify(result.data, null, 2);
                } else {
                    alert('Stub generation failed: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // EV Certificate Operations
        async function performEVCertOperation(operation) {
            const certType = document.getElementById('cert-type').value;
            const algorithm = document.getElementById('cert-algorithm').value;
            const format = document.getElementById('cert-format').value;
            const extension = document.getElementById('cert-extension').value;
            
            const file = document.getElementById('cert-file').files[0];
            const text = document.getElementById('cert-text').value;
            
            if (!file && !text) {
                alert('Please upload a file or enter text for certificate operations.');
                return;
            }
            
            const formData = new FormData();
            if (file) {
                formData.append('file', file);
            } else {
                formData.append('data', text);
            }
            
            formData.append('certificate', certType);
            formData.append('algorithm', algorithm);
            formData.append('format', format);
            formData.append('extension', extension);
            
            try {
                const response = await fetch(`/ev-${operation}`, {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('cert-result').style.display = 'block';
                    document.getElementById('cert-result-content').textContent = JSON.stringify(result.data, null, 2);
                } else {
                    alert(`Certificate ${operation} failed: ` + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Payload Integration
        async function integratePayload() {
            const payloadType = document.getElementById('payload-type').value;
            const encryption = document.getElementById('payload-encryption').value;
            const format = document.getElementById('payload-format').value;
            const extension = document.getElementById('payload-extension').value;
            
            const file = document.getElementById('payload-file').files[0];
            
            if (!file) {
                alert('Please upload a payload file.');
                return;
            }
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('payloadType', payloadType);
            formData.append('encryption', encryption);
            formData.append('format', format);
            formData.append('extension', extension);
            formData.append('stealthFeatures', 'polymorphic,metamorphic,packing');
            formData.append('antiAnalysisFeatures', 'anti-debug,anti-vm,anti-sandbox');
            
            try {
                const response = await fetch('/advanced-encrypt', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('payload-result').style.display = 'block';
                    document.getElementById('payload-result-content').textContent = JSON.stringify(result.data, null, 2);
                } else {
                    alert('Payload integration failed: ' + result.error);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }

        // Helper function to update file display
        function updateFileDisplay(uploadElement, file) {
            const fileName = file.name;
            const fileSize = (file.size / 1024).toFixed(2);
            
            // Preserve the file input element
            const existingFileInput = uploadElement.querySelector('input[type="file"]');
            
            uploadElement.innerHTML = `
                <input type="file" id="${existingFileInput ? existingFileInput.id : 'enc-file'}" style="display: none;" accept="*/*">
                <p>✅ File loaded: ${fileName}</p>
                <p style="font-size: 0.9em; color: #666;">Size: ${fileSize} KB</p>
                <p style="font-size: 0.8em; color: #999;">Click to change file</p>
            `;
            
            // Restore the file to the input
            const newFileInput = uploadElement.querySelector('input[type="file"]');
            if (newFileInput && file) {
                // Create a new FileList with the file
                const dt = new DataTransfer();
                dt.items.add(file);
                newFileInput.files = dt.files;
            }
        }

        // File upload drag and drop
        document.addEventListener('DOMContentLoaded', function() {
            // Add a small delay to ensure all elements are fully loaded
            setTimeout(() => {
                const fileUploads = document.querySelectorAll('.file-upload');
                
                fileUploads.forEach(upload => {
                    // Click handler to open file dialog
                    upload.addEventListener('click', function(e) {
                        const fileInput = this.querySelector('input[type="file"]');
                        if (fileInput) {
                            fileInput.click();
                        } else {
                            console.error('File input not found in upload area');
                        }
                    });
                
                upload.addEventListener('dragover', function(e) {
                    e.preventDefault();
                    this.classList.add('dragover');
                });
                
                upload.addEventListener('dragleave', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                });
                
                upload.addEventListener('drop', function(e) {
                    e.preventDefault();
                    this.classList.remove('dragover');
                    
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const fileInput = this.querySelector('input[type="file"]');
                        // Create a new FileList-like object
                        const dt = new DataTransfer();
                        dt.items.add(files[0]);
                        fileInput.files = dt.files;
                        
                        // Visual feedback
                        updateFileDisplay(this, files[0]);
                    }
                });
                
                // Handle file selection via file dialog
                const fileInput = upload.querySelector('input[type="file"]');
                fileInput.addEventListener('change', function(e) {
                    if (this.files.length > 0) {
                        updateFileDisplay(upload, this.files[0]);
                    }
                });
            });
            
            // Add event listener for encrypt button
            const encryptBtn = document.getElementById('encrypt-btn');
            if (encryptBtn) {
                encryptBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('Encrypt button clicked, DOM ready state:', document.readyState);
                    performAdvancedEncryption();
                });
            } else {
                console.error('Encrypt button not found!');
            }
            
            // Note: File upload event listener is handled by the general file-upload handler above
            }, 100); // Close setTimeout
        });

        // Hotpatcher System Functions
        async function executeHotpatcher() {
            const fileInput = document.getElementById('hotpatcher-file');
            const encryption = document.getElementById('hotpatcher-encryption').value;
            
            if (!fileInput.files[0]) {
                alert('Please select a file to process');
                return;
            }

            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);
            formData.append('encryption', encryption);
            
            // Get selected payloads
            const payloads = Array.from(document.querySelectorAll('#hotpatcher-payloads input:checked')).map(cb => cb.value);
            formData.append('payloads', JSON.stringify(payloads));
            
            // Get selected injection points
            const injectionPoints = Array.from(document.querySelectorAll('#hotpatcher-injection-points input:checked')).map(cb => cb.value);
            formData.append('injectionPoints', JSON.stringify(injectionPoints));
            
            // Get stealth features
            const stealthFeatures = Array.from(document.querySelectorAll('#hotpatcher-stealth input:checked')).map(cb => cb.value);
            formData.append('stealthFeatures', JSON.stringify(stealthFeatures));
            
            // Get anti-analysis features
            const antiAnalysisFeatures = Array.from(document.querySelectorAll('#hotpatcher-anti-analysis input:checked')).map(cb => cb.value);
            formData.append('antiAnalysisFeatures', JSON.stringify(antiAnalysisFeatures));
            
            // Get fileless options
            const filelessOptions = Array.from(document.querySelectorAll('#hotpatcher-fileless input:checked')).map(cb => cb.value);
            formData.append('filelessOptions', JSON.stringify(filelessOptions));

            try {
                showLoading('hotpatcher-result-content', '🔥 Executing Hotpatcher...');
                
                const response = await fetch('/api/hotpatcher/inject', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        encryption: encryption,
                        payloads: payloads,
                        injectionPoints: injectionPoints,
                        stealthFeatures: stealthFeatures,
                        antiAnalysisFeatures: antiAnalysisFeatures,
                        filelessOptions: {
                            memoryOnly: filelessOptions.includes('memory-only'),
                            systemEntropy: filelessOptions.includes('system-entropy'),
                            autoCleanup: filelessOptions.includes('auto-cleanup')
                        }
                    })
                });

                const result = await response.json();
                
                if (result.success) {
                    displayHotpatcherResult(result);
                } else {
                    showError('hotpatcher-result-content', result.error);
                }
            } catch (error) {
                showError('hotpatcher-result-content', 'Hotpatcher execution failed: ' + error.message);
            }
        }

        async function extractPayloads() {
            const fileInput = document.getElementById('hotpatcher-file');
            
            if (!fileInput.files[0]) {
                alert('Please select a file to extract payloads from');
                return;
            }

            const file = fileInput.files[0];
            const formData = new FormData();
            formData.append('file', file);

            try {
                showLoading('hotpatcher-result-content', '🔍 Extracting Payloads...');
                
                const response = await fetch('/api/hotpatcher/inject', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();
                
                if (result.success) {
                    displayPayloadExtractionResult(result);
                } else {
                    showError('hotpatcher-result-content', result.error);
                }
            } catch (error) {
                showError('hotpatcher-result-content', 'Payload extraction failed: ' + error.message);
            }
        }

        async function testHotpatcher() {
            try {
                showLoading('hotpatcher-result-content', '🧪 Testing Hotpatcher System...');
                
                const response = await fetch('/api/hotpatcher/inject', {
                    method: 'POST'
                });

                const result = await response.json();
                
                if (result.success) {
                    displayHotpatcherTestResult(result);
                } else {
                    showError('hotpatcher-result-content', result.error);
                }
            } catch (error) {
                showError('hotpatcher-result-content', 'Hotpatcher test failed: ' + error.message);
            }
        }

        function displayHotpatcherResult(result) {
            const content = document.getElementById('hotpatcher-result-content');
            content.innerHTML = `
                <div class="success-message">
                    <h4>🔥 Hotpatcher Execution Successful!</h4>
                    <div class="result-details">
                        <p><strong>Original File:</strong> ${result.originalFile.name} (${result.originalFile.size} bytes)</p>
                        <p><strong>Encryption:</strong> ${result.encryption.algorithm}</p>
                        <p><strong>Payloads Injected:</strong> ${result.payloads.length}</p>
                        <p><strong>Final Size:</strong> ${result.finalSize} bytes</p>
                        <p><strong>Injection Points:</strong> ${result.injectionPoints.join(', ')}</p>
                        <p><strong>Stealth Features:</strong> ${result.stealthFeatures.join(', ')}</p>
                        <p><strong>Anti-Analysis:</strong> ${result.antiAnalysisFeatures.join(', ')}</p>
                        <p><strong>Fileless Mode:</strong> ${result.filelessOptions.join(', ')}</p>
                    </div>
                    <div class="payload-details">
                        <h5>Injected Payloads:</h5>
                        ${result.payloads.map(payload => `
                            <div class="payload-item">
                                <strong>${payload.type}:</strong> ${payload.size} bytes at ${payload.position}
                            </div>
                        `).join('')}
                    </div>
                    <div class="download-section">
                        <button onclick="downloadFile('${result.downloadUrl}', 'hotpatched_${result.originalFile.name}')" class="btn btn-success">
                            📥 Download Hotpatched File
                        </button>
                    </div>
                </div>
            `;
            document.getElementById('hotpatcher-result').style.display = 'block';
        }

        function displayPayloadExtractionResult(result) {
            const content = document.getElementById('hotpatcher-result-content');
            content.innerHTML = `
                <div class="success-message">
                    <h4>🔍 Payload Extraction Successful!</h4>
                    <div class="result-details">
                        <p><strong>File:</strong> ${result.file.name} (${result.file.size} bytes)</p>
                        <p><strong>Payloads Found:</strong> ${result.payloads.length}</p>
                    </div>
                    <div class="payload-details">
                        <h5>Extracted Payloads:</h5>
                        ${result.payloads.map((payload, index) => `
                            <div class="payload-item">
                                <strong>Payload ${index + 1}:</strong>
                                <p><strong>Type:</strong> ${payload.header.type}</p>
                                <p><strong>Size:</strong> ${payload.header.size} bytes</p>
                                <p><strong>Position:</strong> ${payload.position}</p>
                                <p><strong>Timestamp:</strong> ${payload.header.timestamp}</p>
                                <p><strong>Signature:</strong> ${payload.header.signature}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            document.getElementById('hotpatcher-result').style.display = 'block';
        }

        function displayHotpatcherTestResult(result) {
            const content = document.getElementById('hotpatcher-result-content');
            content.innerHTML = `
                <div class="success-message">
                    <h4>🧪 Hotpatcher Test Results</h4>
                    <div class="result-details">
                        <p><strong>Test Status:</strong> ${result.status}</p>
                        <p><strong>Algorithms Tested:</strong> ${result.algorithms.length}</p>
                        <p><strong>Payload Types:</strong> ${result.payloadTypes.length}</p>
                        <p><strong>Injection Points:</strong> ${result.injectionPoints.length}</p>
                    </div>
                    <div class="test-details">
                        <h5>Algorithm Tests:</h5>
                        ${result.algorithms.map(alg => `
                            <div class="test-item">
                                <strong>${alg.name}:</strong> ${alg.status} (${alg.size} bytes)
                            </div>
                        `).join('')}
                    </div>
                    <div class="test-details">
                        <h5>Payload Tests:</h5>
                        ${result.payloadTypes.map(payload => `
                            <div class="test-item">
                                <strong>${payload.type}:</strong> ${payload.status} (${payload.size} bytes)
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
            document.getElementById('hotpatcher-result').style.display = 'block';
        }
        
        // Utility functions for error handling and file operations
        function checkFileSize(file, fileName) {
            const maxSize = 1024 * 1024 * 1024; // 1GB - WIDE OPEN
            if (file.size > maxSize) {
                showResult('warning', `File ${fileName} is too large (${(file.size / 1024 / 1024).toFixed(2)}MB). Maximum size is ${maxSize / 1024 / 1024}MB.`);
                return false;
            }
            return true;
        }
        
        function showProgressIfNeeded(fileSize) {
            if (fileSize > 100 * 1024 * 1024) { // Show progress for files > 100MB - WIDE OPEN
                showLoading('enc-result-content', 'Processing large file...');
            }
        }
        
        function addLog(message, type = 'info') {
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

    </script>
</body>
</html>
